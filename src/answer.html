<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
		<title>答题</title>
		<link rel="stylesheet" href="res/css/answer.css?v=1.0">
		<script>
			function setRem() {
				document.documentElement.style.fontSize = document.documentElement.clientWidth / 15 + 'px';
			}
			window.onresize = setRem;
			setRem();
		</script>
	</head>

	<body>
		<div class="wrap">
			<!--<div class="question">
				<i class="label">01</i>
				<p class="ques">几岁的小朋友可以参加活动？</p>
				<p class="answer">A.3-12岁 <img src="res/img/static/gou.png" /></p>
				<p class="answer">B.5-15岁 <img src="res/img/static/gou.png" /></p>
				<p class="answer sta">C.6-15岁 <img src="res/img/static/gou.png" /></p>
				<p class="answer">D.6-18岁<img src="res/img/static/gou.png" /></p>
			</div>
			<div class="toCreate">提交</div>-->
		</div>

		<div class="alert clock">
			<div class="cover"></div>
			<div class="content">
				<p class="tips1">开始报名前，请先完成答题考验！</p>
				<div class="timer"></div>
			</div>
		</div>
		<div class="alert retry">
			<div class="cover"></div>
			<div class="content2">
				<p class="tips1">答题成绩</p>
				<p class="tips2"><i>80</i>分</p>
				<p class="tips3">请仔细阅读活动介绍</p>
				<div class="searchAns">寻找答案</div>
				<p class="retryBtn">再答一次</p>
			</div>
		</div>
		<div class="alert succ">
			<div class="cover"></div>
			<div class="content3">
				<p class="tips1">答题成绩</p>
				<p class="tips2"><i>100</i>分</p>
				<p class="tips3">恭喜你获得报名资格！</p>
				<div class="toBm">进入报名</div>
			</div>
		</div>

		<!-- Dom Content End -->
	</body>
	<script src="res/libs/jquery/jquery.min.js"></script>
	<script>
		$(function() {
			Init();

			function Init() {
				getQuestions();
				var indexClock = 5;
				var timerDom = $('.timer');
				var timer = setInterval(function() {
					if(indexClock <= 0) {
						clearInterval(timer)
						$('.clock').hide();
						return
					}
					timerDom.html(indexClock--)
				}, 1000)
				events();
			}
			
			function getQuestions(){
				$.ajax({
					type:"post",
					url:"http://shanxing100.fupin.org.cn/api/exam/getsubjects",
					async:true,
					dataType: 'jsonp',
					success: function(res){
						console.log(res)
						if(res.code == 0){
							var html = '';
							for(var i =0;i<res.data.subjects.length;i++){
								html += '<div class="question">'+
										'<i class="label">'+ i +'</i>'+
										'<p class="ques">'+ res.data.subjects[i].title +'</p>'+
										'<p class="answer" data-answer="A">A.'+ res.data.subjects[i].options[0].title +' <img src="res/img/static/gou.png" /></p>'+
										'<p class="answer" data-answer="B">B.'+ res.data.subjects[i].options[1].title +' <img src="res/img/static/gou.png" /></p>'+
										'<p class="answer" data-answer="C">C.'+ res.data.subjects[i].options[2].title +' <img src="res/img/static/gou.png" /></p>'+
										'<p class="answer" data-answer="D">D.'+ res.data.subjects[i].options[3].title +'<img src="res/img/static/gou.png" /></p>'+
									'</div>'
							}
							html += '<div class="toCreate">提交</div>';
							$('.wrap').html(html)
						}
					}
				});
			}
			
			function events() {
				$('.toBm').click(function() {
					location.href = 'myteam.html'
				})
				$('.searchAns').click(function() {
					location.href = 'introduce.html'
				})
				$('.retryBtn').click(function() {
					$('.retry').hide()
					$('.cur').removeClass('cur')
				})

				$('.wrap').on('click','.answer', function() {
					$(this).addClass('cur').siblings().removeClass('cur')
				})
				
				$('.wrap').on('click','.toCreate', function() {
					var answerEles = $('.cur');
					var ansArr = [];
					for(var i=0;i< answerEles.length;i++){
						ansArr.push( answerEles.eq(i).attr('data-answer'))
					}
					$.ajax({
						type:"post",
						url:"http://shanxing100.fupin.org.cn/api/exam/submit",
						async:true,
						data:{
							answer: ansArr.join(',')
						},
						dataType: 'jsonp',
						success: function(res){
							console.log(res)
							if(res.code == 0){
								//globalMes( res.msg)
							}
							globalMes( res.msg)
						}
					});
				})
			}
			
			function globalMes(txt,callback) {
				$('body').append('<div class="globalmes">' + txt + '</div>')
				setTimeout(function() {
					$('.globalmes').remove();
					if(callback){
						callback();
					}
				}, 2000)
			}
		})
	</script>

</html>